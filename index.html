<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title></title>
<link rel="stylesheet" type="text/css" href="https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.css"/>
<style>
body { margin: 0; top: 0; bottom: 0; width: 100%; }
#map { position: absolute; top: 0; bottom: 0; width: 100%; }
</style>
<script src="https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.js"></script>
</head>
<body>
<div id="map"></div>
<script>
data = [
  { iso3cd: 'AFG', value: 22 }
]

expression = ["match", ["get", "iso3cd"]]
data.forEach(function(row) {
  color = null
  if (row.value === 0) {
    color = ["rgb", 153, 0, 51]
  } else if (row.value <= 50) {
    color = ["rgb", 255, 117, 25]
  } else if (row.value < 100) {
    color = ["rgb", 48, 131, 255]
  } else {
    color = ["rgb", 0, 61, 153]
  }
  expression.push(row.iso3cd, color)
})
expression.push(["rgb", 100, 100, 100])

style = {
  "version": 8,
  "sprite": "https://hfu.github.io/unite-sprite/sprite",
  "glyphs": "https://vectortiles.xyz/fonts/{fontstack}/{range}.pbf",
  "sources": {
    "iso3cd": {
      "type": "geojson",
      "data": "https://hfu.github.io/iso3cd-scaffold/scaffold.geojson"
    }
  },
  "layers": [
    {
      "id": "iso3cd-circle",
      "type": "circle",
      "source": "iso3cd",
      "layout": {},
      "paint": {
        "circle-radius": [
          "interpolate",
          [
            "exponential",
            2
          ],
          [
            "zoom"
          ],
          0,
          4,
          6,
          400
        ],
        "circle-color": expression
      }
    },
    {
      "id": "iso3cd-symbol",
      "type": "symbol",
      "source": "iso3cd",
      "minzoom": 2,
      "layout": {
        "text-font": [
          "sans"
        ],
        "text-field": [
          "step",
          [
            "zoom"
          ],
          [
            "get",
            "iso3cd"
          ],
          4,
          [
            "get",
            "name"
          ]
        ]
      },
      "paint": {
        "text-color": [
          "rgb",
          255,
          255,
          255
        ]
      }
    }
  ]
}

map = new mapboxgl.Map({
  container: 'map', 
  style: style,
  attributionControl: true, hash: true
})

map.on('load', function() {
  map.addControl(new mapboxgl.NavigationControl())
})
</script>
</body>
</html>
